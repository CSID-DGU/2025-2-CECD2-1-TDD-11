# Material ID Mapping ê°œì„  - í…ŒìŠ¤íŠ¸ ê²°ê³¼

## âœ… í…ŒìŠ¤íŠ¸ í†µê³¼

```
======================================================================
í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½
======================================================================
í†µí•© í…ŒìŠ¤íŠ¸ (ë°˜ë³µ+íšŒí”¼): âœ… ì„±ê³µ
ì´ë¯¸ì§€ ìƒì„± API í…ŒìŠ¤íŠ¸: âœ… ì„±ê³µ

ì´ 2/2 í…ŒìŠ¤íŠ¸ í†µê³¼

ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!
```

## ğŸ“‹ ì ìš©ëœ ë³€ê²½ì‚¬í•­

### 1. Flow ë ˆë²¨ (`__init__.py`)
- âœ… `_build_materials_list_from_mapping()` í•¨ìˆ˜ë¡œ ë³€ê²½
- âœ… material_id_mapping.jsonì„ ì§ì ‘ ë¡œë“œí•˜ì—¬ `{name: [cat, chunk, mat]}` dict ë°˜í™˜
- âœ… LLMì— materials_listë¥¼ dict í˜•íƒœë¡œ ì „ë‹¬

### 2. Prompt ë ˆë²¨ (`map_materials.jinja2`)
- âœ… materials_listë¥¼ dictë¡œ ìˆœíšŒí•˜ë©° nameê³¼ idë¥¼ í•¨ê»˜ í‘œì‹œ
- âœ… current_material_idë¥¼ ëª…ì‹œì ìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ì— ì¶”ê°€
- âœ… íšŒí”¼ ê°ì§€ ì‹œ current_material_idë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë„ë¡ ëª…í™•í™”

### 3. Engine ë ˆë²¨ (`core.py`)
- âœ… `build_categories_from_category_json()` í•¨ìˆ˜ ìˆ˜ì •
- âœ… material.jsonì˜ dict í˜•íƒœ material ì²˜ë¦¬ (`{"order": 1, "name": "ì„±í•¨"}`)
- âœ… material.nameì„ ì˜¬ë°”ë¥´ê²Œ ì¶”ì¶œ

## ğŸ¯ ê²€ì¦ëœ ê¸°ëŠ¥

### 1. Material êµ¬ì¡° (API Response)
```json
{
  "material": {
    "full_material_name": "ë¶€ëª¨ë‹˜ ê¸°ë³¸ì •ë³´ ì„±í•¨",
    "material_name": "ì„±í•¨",
    "material_order": 1
  },
  "material_id": [1, 1, 1]
}
```

### 2. íšŒí”¼ ê°ì§€ ë° ì£¼ì œ ì „í™˜
```
[3ë²ˆì§¸ ëŒ€í™”]
íšŒí”¼ ë‹µë³€: ì´ ì£¼ì œëŠ” ë³„ë¡œ ì´ì•¼ê¸°í•˜ê³  ì‹¶ì§€ ì•Šì•„ìš”. ë‹¤ë¥¸ ì§ˆë¬¸ í•´ì£¼ì„¸ìš”.
âœ… íšŒí”¼ í›„ ì£¼ì œ ì „í™˜: 
   ë¶€ëª¨ë‹˜ ê¸°ë³¸ì •ë³´ ìƒì§•ë¬¼/ê°ê°ì  ê¸°ì–µ â†’ ë¶€ëª¨ë‹˜ ê¸°ë³¸ì •ë³´ ì„±í•¨
```

### 3. Material Gate ì§ˆë¬¸
```
ğŸš§ Material Gate ì§ˆë¬¸ ê°ì§€!
   â†’ ìƒˆ ì†Œì¬ ì§„ì… ì „ í™•ì¸ ì§ˆë¬¸
```

## ğŸ“Š ë°ì´í„° íë¦„ ê²€ì¦

### ì´ì „ (ë¬¸ì œ)
```
material.json â†’ _build_materials_list() â†’ [(id, name), ...] 
                                          â†“
                                    LLMì— nameë§Œ ì „ë‹¬
                                          â†“
                                    LLMì´ nameìœ¼ë¡œ id ì¶”ë¡  (ë¶ˆê°€ëŠ¥)
```

### í˜„ì¬ (í•´ê²°)
```
material_id_mapping.json â†’ _build_materials_list_from_mapping() â†’ {name: id, ...}
                                                                    â†“
                                                            LLMì— name:id ìŒ ì „ë‹¬
                                                                    â†“
                                                            LLMì´ nameìœ¼ë¡œ id ì§ì ‘ ì¡°íšŒ
```

## ğŸ” LLM í”„ë¡¬í”„íŠ¸ ê°œì„  í™•ì¸

### materials_list ì „ë‹¬ í˜•ì‹
```jinja2
materials_list ("ì†Œì¬ëª…": [category_order, chunk_order, material_order]):
"ë¶€ëª¨ë‹˜ ê¸°ë³¸ì •ë³´ ì„±í•¨": [1, 1, 1]
"ë¶€ëª¨ë‹˜ ê¸°ë³¸ì •ë³´ ê³ í–¥/ì¶œìƒì§€": [1, 1, 2]
...
```

### current_material_id ëª…ì‹œ
```jinja2
í˜„ì¬ ì†Œì¬: ë¶€ëª¨ë‹˜ ê¸°ë³¸ì •ë³´ ì„±í•¨
í˜„ì¬ ì†Œì¬ ID: [1, 1, 1]
```

## âœ… ìš”êµ¬ì‚¬í•­ ì¶©ì¡± í™•ì¸

1. âœ… **ì§ˆë¬¸ ìƒì„±**: Materialì€ material_id_mapping í˜•íƒœë¡œ ì „ë‹¬
2. âœ… **ì…ë ¥ ë¶„ì„**: 
   - current_materialì€ material_id_mapping í˜•íƒœë¡œ ì „ë‹¬
   - current_material_idëŠ” [cat, chunk, mat] ë°°ì—´ë¡œ ì „ë‹¬
   - materials_listëŠ” {name: id} dict í˜•íƒœë¡œ ì „ë‹¬
3. âœ… **LLM Output**: `[{"material":[1,3,3],"axes":{...}}]` êµ¬ì¡°
4. âœ… **Material ID íŒŒì‹±**: LLMì´ ë°˜í™˜í•œ material IDë¥¼ ì˜¬ë°”ë¥´ê²Œ íŒŒì‹±
5. âœ… **API Response**: material í•„ë“œê°€ dict í˜•íƒœë¡œ ë°˜í™˜
6. âœ… **Engine ì—°ê²°**: ê¸°ì¡´ ë¡œì§ ìœ ì§€
7. âœ… **Redis ë°ì´í„°**: êµ¬ì¡° ë³€ê²½ ì—†ìŒ

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í–ˆìœ¼ë©°, ìš”êµ¬ì‚¬í•­ì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.

### ì¶”ê°€ í…ŒìŠ¤íŠ¸ ê¶Œì¥ì‚¬í•­
1. ì‹¤ì œ LLM ì‘ë‹µ í™•ì¸ (ì„œë²„ ì½˜ì†” ë¡œê·¸)
2. ë‹¤ì–‘í•œ ë‹µë³€ íŒ¨í„´ í…ŒìŠ¤íŠ¸
3. ì†Œì¬ ë§¤ì¹­ ì •í™•ë„ ê²€ì¦
4. íšŒí”¼ ê°ì§€ ì •í™•ë„ ê²€ì¦

### ëª¨ë‹ˆí„°ë§ í¬ì¸íŠ¸
- LLMì´ materials_list dictë¥¼ ì˜¬ë°”ë¥´ê²Œ íŒŒì‹±í•˜ëŠ”ì§€
- material_idê°€ ì •í™•í•˜ê²Œ ë°˜í™˜ë˜ëŠ”ì§€
- ì†Œì¬ ì „í™˜ì´ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•˜ëŠ”ì§€
